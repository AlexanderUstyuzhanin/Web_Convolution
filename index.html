<!DOCTYPE html>


<html>
<head>
    <meta charset="utf-8"/>
    <title>Graphical Convolution Demonstrator & More</title>
	
	<!-- JS Libraries -->
	<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			extensions: ["tex2jax.js"],
			jax: ["input/TeX", "output/HTML-CSS"],
			tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]}
		});
	</script>
	<script type="text/javascript" async
		src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
	</script>
	<script type="text/javascript" src="js/libs/math.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="js/libs/jsxgraphcore.js" charset="utf-8"></script>
	
	<!-- Custom JS Scripts -->
    <script type="text/javascript" src="js/style.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    <script type="text/javascript" src="js/audio_conv.js"></script>
    <script type="text/javascript" src="js/plots.js"></script>
    <script type="text/javascript" src="js/math_functions.js"></script>
    <script type="text/javascript" src="js/udf.js"></script>
	
	<!-- Cascading Style Sheets -->
    <link rel="stylesheet" type="text/css" href="css/style.css"/>
    <link rel="stylesheet" type="text/css" href="css/jsxgraph.css"/>
    <link rel="stylesheet" type="text/css" href="css/visualization.css"/>
	
</head>

<body>
    <h1>This is a web-based convolution demonstrator.</h1>
    <div class="tabs">
        <ul class="tab-links">
            <li class="active"><a href="#tab1">Convolution graph</a></li>
            <li><a href="#tab2">Audio Convolution</a></li>
        </ul>

        <div class="tab-content">
            <div id="tab1" class="tab active">
                <div id ="space" class ="space" > </div> <!-- Create some space on the left of the screen -->

                <!-- User input area -->
                <div id ="formField" class="formField" align="top" >

                    <form>
                        <fieldset>
                            <legend>User Input Area</legend>
                            <p>
                                <label>Select Function 1:</label>

                                <select id = "functionList1" onchange="plot1(brd)">
                                    <option value = "1">Rectangle</option>
                                    <option value = "2">Triangle</option>
                                    <option value = "3">Gaussian</option>
                                    <option value = "4">Sinc</option>
                                    <option value = "5">Step</option>
                                </select><br>

                                Function 1 Width: <input type="text" id="F1_width" 
									size="4" value="1" onchange="plot1(brd)" /><br>
                                Function 1 Shift: <input type="text" id="F1_shift" 
									size="4" value="0" onchange="plot1(brd)" /><br>
                            </p>

                            <p>
                                <label>Select Function 2:</label>

                                <select id = "functionList2" onchange = "plot2(brd)">
                                    <option value = "1">Triangle</option>
                                    <option value = "2">Rectangle</option>
                                    <option value = "3">Gaussian</option>
                                    <option value = "4">Sinc</option>
                                    <option value = "5">Step</option>
                                </select><br>

                                Function 2 Width: <input type="text" id="F2_width" 
									size="4" value="1" onchange="plot2(brd)" /><br>
                                Function 2 Shift: <input type="text" id="F2_shift"
									size="4" value="0" onchange="plot2(brd)" /><br>
                            </p>

                            <p>
                                <button id="convoBtn" onclick="doConvo(brd2); return false;" >
                                    Convolution
                                </button>
                                <button id="corrBtn" onclick="doCorrelation(brd2); return false;" >
                                    Correlation
                                </button>
								<button id="slideBtn" onclick="reDrawSignal2(); return false;" >
									Slide Along
								</button>
                            </p>

                        </fieldset>
						
						<!-- User defined functions -->
						<fieldset>
							<legend>User-defined function</legend>
							<div id="divUDF">
								<p>
									<label>Your function </label>
									<input type="text" id="txtUserExpression" value="0.3*(x^2 + 5*x)" /> <br> <br>
									<label>Evaluate at </label> 
									<input type="text" id="txtEvalPoint" value="0" /> <br> <br>
									<button name="btnParse" onclick="return parseMathExpr()">Parse expression</button> <br> <br>
									<label>Result </label>
									<input type="text" id="txtEvalRes" value="N/A" /> <br> <br>
								</p>
							</div>
							<div id="divTexExpr">Your expression: ${}$</div>
						</fieldset>
                    </form>

                </div>
                <!-- User input area ends ------------------------------------------------------------------------>

                <!-- Create two JSXGRAPH boards to hold all the plots -->
                        <div id ="boxGroup" class="boxGroup">

							<div id="jxgbox" class="jxgbox" style="width:600px; height:300px" ></div>
							
							<script type="text/javascript">
								// The upper board goes from -4 to 4 on the X-axis and -0.3 to 2 on the Y-axis
								var brd = JXG.JSXGraph.initBoard('jxgbox', {boundingbox: [-4, 2, 4, -0.3], axis:true});
								
							</script>
									
							<div  style="width:600px; height:20px" ></div>   <!-- small space between the boards -->
							
							<div id="jxgbox2" class="jxgbox" style="width:600px; height:300px" ></div>   
								
							<script type="text/javascript">
								// The lower board goes from -8 to 8 on the X-axis and -1 to 2 on the Y-axis
								var brd2 = JXG.JSXGraph.initBoard('jxgbox2', {boundingbox: [-8, 2, 8, -1], axis:true, 
									pan: {
										  enabled: false ,  // Allow panning
										  needTwoFingers: true, // panning is done with two fingers on touch devices
										  needshift: true, // mouse panning needs pressing of the shift key
										}}); 
								
								var equalCoords = 0;
								previousCoordinateArray = brd.getBoundingBox();
								brd.on('boundingbox', function(){ 
									currentCoordinateArray = brd.getBoundingBox();
									brd2.setBoundingBox(brd.getBoundingBox());
									generateSamplePoints(currentCoordinateArray[0], currentCoordinateArray[2]); // generate sample points for the 2 functions in the upper graph
									plot1(brd);
									plot2(brd);
									for (i = 0; i < 4; i++){
										if(previousCoordinateArray[i] == currentCoordinateArray[i]){ equalCoords++ }
									}
									if (equalCoords == 0){
										if (convoCorr == 0) doConvo(brd2);
										else if (convoCorr == 1) doCorrelation(brd2);
										previousCoordinateArray = currentCoordinateArray; 
									}
									
									equalCoords = 0;          	
								});

								generateSamplePoints(previousCoordinateArray[0], previousCoordinateArray[2]); // generate sample points for the 2 functions in the upper graph
								// Plot 2 functions (rect() and tri()) as start up case on the upper board
								start(brd,brd2); // plot pre-selected functions on start-up
							   
							</script>
						</div>
            </div>
			
			<!-- Audio convolution stuff -->
            <div id="tab2" class="tab">
                <h1>Audio convolution</h1>
                <p>Select an audio example to try
                    <select id="audioPreset">
                        <option value="" disabled selected style="display:none;">Select an audio example...</option>
                        <option value="theForce">The Force</option>
                        <option value="chime">Chime</option>
                    </select>
                    &emsp; &emsp; OR &emsp; &emsp; Choose a file from your computer to try:
                    <input type="file" id="files" name="files[]" />
                </p>
                <p>Input sound:</p>
                <audio id="inputSound" controls></audio>
                <p>Choose from presets
                    <select id="irPreset">
                        <option value="" disabled selected style="display:none;">Select an impulse response...</option>
                        <option value="carpark" title="Underground car park">Car park</option>
                        <option value="slinky" title="Slinky toy">Slinky</option>
                        <option value="centreStalls" title="Central Hall, University of York">Central Hall</option>
                    </select>
                    &emsp; &emsp; OR &emsp; &emsp; Choose an impulse response
                    <input type="file" id="iFiles" name="files[]" />


                </p>
                <p>Impulse response:</p>
                <audio id="impulseResponse" controls></audio>

                <p>Result:</p>
                <audio id="outputSound" controls></audio>
                <output id="list"></output>
            </div>
			<!-- Audio convolution stuff ends -->
        </div> <!-- tab content -->
    </div> <!-- tabs -->

</body>
</html>
